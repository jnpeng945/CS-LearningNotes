## 网络基础

**同⼀台设备上**的进程间通信方式：管道、消息队列、共享内存、信号等

**不同设备上**的进程间通信方式：网络通信，鉴于设备的兼容性，就协商了一套通用的分层网络协议。

![img](Figs/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C_1)

### 1 应用层

[电脑手机软件是在应用层实现]()，不同设备的应用需要通信时，应⽤就把应用数据传给传输层。应用层只需要为用户提供应⽤功能，不用关心数据如何传输。应用层工作在操作系统中的**用户态**，传输层及以下工作在**内核态**。

### 2 传输层

作用：为应用层提供网络支持。

**TCP**（传输层控制协议，Transmission Control Protocol）：多数应用使用的是TCP协议，如HTTP应用层协议，TCP为保证数据包能可靠地传输给对⽅（**可靠传输**），提供了<u>流量控制、超时重传、拥塞控制</u>。

**UCP**：负责发送数据包，不保证数据包能否抵达目的地，相比于TCP实时性更好，传输效率更高。

<span style='color:red'>UDP实现可靠传输：将TCP的特性在应⽤层上实现</span>

TCP段（TCP Segment）：也就是分块的数据包。应用需要传输的数据可能非常⼤，直接传输就不好控制。当传输层的数据包大小超过MSS（TCP最大报文段长度），便将数据包分块，即使丢失分块只需重传对应分块即可。

问：如何确保传输层的数据包准备传给接收方设备上指定的应用进程？

答：端口区分应用，如 80 端口是 Web 服务器用的，22 端口是远程登录服务器用的，对于浏览器（客户端）中的每个标签栏都是⼀个独立的进程，操作系统会为这些进程分配**临时的端口号**。

### 3 网络层

IP 协议（*Internet Protocol*）：将传输层的报文作为数据部分，再加上 IP 包头组装成 IP 报⽂，如果 IP 报文大小超过 MTU（以太网中⼀般为 1500 字节）就会再次进行分片，得到⼀个即将发送到网络的 IP 报文。

网络号：标识IP地址是属于哪个子网；主机号：标识同一子网下的不同主机；IP地址配合子网掩码算出IP地址的网络号和主机号。

IP协议的寻址作用就是告诉我们去下一个目的地应该朝哪个方向走，路由就是根据下一个目的地选择路径。

### 4 数据链路层

设备的网卡有⼀个唯一的 MAC 地址用来标识设备，路由器计算了下一个目的地的IP地址，再根据ARP协议找到该目的地的MAC地址，这样就知道这个IP地址属于哪个设备。

### 5 物理层

作用：为数据链路层提供二进制传输的服务，将数据包转换为电信号，让其在物理介质中传输。



> 图解网络
